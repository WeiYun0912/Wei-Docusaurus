"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4864],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),i=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=i(e.components);return r.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=i(t),g=a,k=c["".concat(p,".").concat(g)]||c[g]||m[g]||s;return t?r.createElement(k,o(o({ref:n},u),{},{components:t})):r.createElement(k,o({ref:n},u))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var i=2;i<s;i++)o[i]=t[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},9016:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>l,toc:()=>i});var r=t(7462),a=(t(7294),t(3905));const s={title:"[graphql] GraphQL \u8207 Apollo Server \u4f7f\u7528\u6559\u5b78 Part 2",keywords:["graphql"]},o=void 0,l={unversionedId:"GraphQL/graphql-2",id:"GraphQL/graphql-2",title:"[graphql] GraphQL \u8207 Apollo Server \u4f7f\u7528\u6559\u5b78 Part 2",description:"\u5f71\u7247\u8b1b\u89e3 Part 1",source:"@site/docs/GraphQL/graphql-2.md",sourceDirName:"GraphQL",slug:"/GraphQL/graphql-2",permalink:"/Wei-Docusaurus/docs/GraphQL/graphql-2",draft:!1,tags:[],version:"current",frontMatter:{title:"[graphql] GraphQL \u8207 Apollo Server \u4f7f\u7528\u6559\u5b78 Part 2",keywords:["graphql"]},sidebar:"tutorialSidebar",previous:{title:"[graphql] GraphQL \u8207 Apollo Server \u4f7f\u7528\u6559\u5b78 Part 1",permalink:"/Wei-Docusaurus/docs/GraphQL/graphql-1"},next:{title:"MongoDB",permalink:"/Wei-Docusaurus/docs/category/mongodb"}},p={},i=[{value:"Args",id:"args",level:2},{value:"Context",id:"context",level:2},{value:"Context 2",id:"context-2",level:2},{value:"Fragment",id:"fragment",level:2},{value:"Interface",id:"interface",level:2},{value:"Union",id:"union",level:2}],u={toc:i};function m(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=1GC4tPj-IjE"},"\u5f71\u7247\u8b1b\u89e3 Part 1")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=jrlqFB7dkEw"},"\u5f71\u7247\u8b1b\u89e3 Part 2")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=RkEUJFxB51o"},"\u5f71\u7247\u8b1b\u89e3 Part 3")),(0,a.kt)("h2",{id:"args"},"Args"),(0,a.kt)("p",null,"\u5047\u8a2d\u4eca\u5929\u60f3\u8981\u55ae\u7368\u67e5\u8a62\u66f8\u672c\u7684\u8cc7\u8a0a\u8981\u600e\u9ebc\u505a\u5462?\n\u4e00\u822c\u7684\u4f5c\u6cd5\u90fd\u662f\u5229\u7528 ",(0,a.kt)("strong",{parentName:"p"},"id")," \u4f86\u627e\u5c0b\u8cc7\u6599\uff0c\u800c\u5728 GraphQL \u4e00\u6a23\u53ef\u4ee5\u9760\u5916\u90e8\u53c3\u6578\u4f86\u627e\u5c0b\u7279\u5b9a\u7684\u8cc7\u6599\uff0c\u4f86\u770b\u4ee5\u4e0b\u7bc4\u4f8b\uff1a"),(0,a.kt)("p",null,"\u5728 type \u5b9a\u7fa9\u6642\u5fc5\u9808\u591a\u52a0\u4e00\u689d\u898f\u5247\uff0c\u4e5f\u5c31\u662f\u7a0b\u5f0f\u78bc\u7b2c 13 \u884c\uff0c\u62ec\u865f\u7684\u610f\u601d\u662f\u63a5\u6536\u7684\u53c3\u6578\u540d\u7a31\u8207\u53c3\u6578\u578b\u614b\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="typeDefs.js" showLineNumbers',title:'"typeDefs.js"',showLineNumbers:!0},'const { gql } = require("apollo-server");\n\nconst typeDefs = gql`\n  type Book {\n    id: ID!\n    name: String!\n    author: String!\n    publish: String!\n  }\n\n  type Query {\n    books: [Book!]\n    book(id: ID): Book\n  }\n`;\n\nmodule.exports = typeDefs;\n')),(0,a.kt)("p",null,"\u540c\u6a23\u7684\u4e5f\u5fc5\u9808\u5728 resolvers \u5be6\u4f5c\uff0c\u5148\u4f86\u770b\u5982\u4f55\u50b3\u5165\u5916\u90e8\u53c3\u6578\u3002"),(0,a.kt)("p",null,"\u5728\u4e0b\u65b9\u7684 Variables \u5167\u5b9a\u7fa9 bookId\uff0c\u540d\u7a31\u53ef\u4ee5\u81ea\u5df1\u53d6\uff0c\u4f46\u8981\u8ddf query \u50b3\u5165\u7684\u540d\u7a31\u4e00\u6a23\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/GiVNlXo.png",alt:null})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="resolvers.js" showLineNumbers',title:'"resolvers.js"',showLineNumbers:!0},"const Books = require(\"../tempData\");\n\nconst resolvers = {\n  Query: {\n    books: () => {\n      return Books;\n    },\n\n    book: (parent, args) => {\n      console.log(args); // output : { id : '1' }\n      return Books.find((book) => book.id === +args.id);\n    },\n  },\n};\n\nmodule.exports = resolvers;\n")),(0,a.kt)("h2",{id:"context"},"Context"),(0,a.kt)("p",null,"Context \u6709\u9ede\u50cf\u662f Middleware\uff0cContext \u53ef\u4ee5\u62ff\u4f86\u505a\u4e00\u4e9b\u9a57\u8b49\uff0c\u50cf\u662f JWT\uff0c\u76f4\u63a5\u4f86\u770b\u7bc4\u4f8b\u3002"),(0,a.kt)("p",null,"\u8981\u555f\u7528 Context \u5fc5\u9808\u5728 Server \u505a\u8a2d\u5b9a\uff0c\u9019\u908a\u76f4\u63a5\u56de\u50b3 request\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="server.js" showLineNumbers',title:'"server.js"',showLineNumbers:!0},'const { ApolloServer } = require("apollo-server");\nconst resolvers = require("./schema/resolvers");\nconst typeDefs = require("./schema/typeDefs");\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n  context: ({ req }) => {\n    return req;\n  },\n});\n\nserver.listen().then(({ url }) => {\n  console.log(`Server Url : ${url}`);\n});\n')),(0,a.kt)("p",null,"\u56de\u50b3\u7684 context \u53ef\u4ee5\u5728 resolvers \u505a\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="resolvers.js" showLineNumbers',title:'"resolvers.js"',showLineNumbers:!0},'const { Authors, Books } = require("../tempData");\n\nconst resolvers = {\n  Query: {\n    books: (parent, args, context) => {\n      console.log(context.headers);\n      return Books;\n    },\n  },\n};\n\nmodule.exports = resolvers;\n')),(0,a.kt)("p",null,"\u76f4\u63a5\u5728\u5f8c\u53f0\u67e5\u8a62 books \u5f8c\u67e5\u770b TERMINAL\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/q2BM0We.png",alt:null})),(0,a.kt)("h2",{id:"context-2"},"Context 2"),(0,a.kt)("p",null,"\u7576\u7136\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c07\u7bc4\u4f8b\u8cc7\u6599\u50b3\u5165 Context\uff0c\u4e4b\u5f8c\u5c31\u4e0d\u7528\u5728 resolvers \u53bb\u5f15\u5165\u7bc4\u4f8b\u8cc7\u6599\uff01"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"server.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="server.js" showLineNumbers',title:'"server.js"',showLineNumbers:!0},'const { ApolloServer } = require("apollo-server");\nconst resolvers = require("./schema/resolvers");\nconst typeDefs = require("./schema/typeDefs");\nconst { Books } = require("./tempData");\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n  context: {\n    Books,\n  },\n});\n\nserver.listen().then(({ url }) => {\n  console.log(`Server Url : ${url}`);\n});\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="resolvers.js" showLineNumbers',title:'"resolvers.js"',showLineNumbers:!0},"const resolvers = {\n  Query: {\n    books: (parent, args, context) => {\n      return context.Books;\n    },\n  },\n};\n\nmodule.exports = resolvers;\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/Ch6sQDM.png",alt:null})),(0,a.kt)("h2",{id:"fragment"},"Fragment"),(0,a.kt)("p",null,"\u7576\u56de\u50b3\u503c\u592a\u591a\u7684\u6642\u5019\uff0c\u6216\u662f\u591a\u500b type \u56de\u50b3\u7684\u503c\u90fd\u4e00\u6a23\u6642\u53ef\u4ee5\u4f7f\u7528",(0,a.kt)("strong",{parentName:"p"},"Fragment"),"\u4f86\u7c21\u5316\uff0c\u76f4\u63a5\u4f86\u770b\u4ee5\u4e0b\u7bc4\u4f8b\u3002"),(0,a.kt)("p",null,"\u5047\u8a2d\u8981\u56de\u50b3\u7684\u503c\u6709\u4ee5\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},"query Books {\n  books {\n    id\n    name\n    author\n    publish\n  }\n}\n")),(0,a.kt)("p",null,"\u5247\u53ef\u4ee5\u5229\u7528",(0,a.kt)("strong",{parentName:"p"},"Fragment"),"\u4f86\u5c07\u8981\u56de\u50b3\u7684\u503c\u500b\u5225\u7368\u7acb\u51fa\u4f86\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},"query Books {\n  books {\n    ...BookFragement\n  }\n}\n\nfragment BookFragement on Book {\n  id\n  name\n  author\n  publish\n}\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/ujs5Idd.png",alt:null})),(0,a.kt)("h2",{id:"interface"},"Interface"),(0,a.kt)("p",null,"\u5584\u7528",(0,a.kt)("strong",{parentName:"p"},"Interface"),"\u80fd\u5920\u6709\u6548\u7ba1\u7406\u578b\u614b\uff0cInterface type \u53ef\u4ee5\u63d0\u4f9b\u4e00\u7d44 fields \u8b93\u4e0d\u540c\u7684\u7269\u4ef6(Object)\u5171\u4eab\uff0c\u6211\u5011\u76f4\u63a5\u4f86\u770b\u7bc4\u4f8b\u3002"),(0,a.kt)("p",null,"\u6211\u5011\u7528\u4ee5\u4e0b\u7bc4\u4f8b\u4f86\u770b\uff0c\u5982\u679c\u8981\u5728 GraphQL \u56de\u50b3\u4e0b\u9762\u7684\u7bc4\u4f8b\u8cc7\u6599\uff0c\u5247\u5fc5\u9808\u5728\u5b9a\u7fa9 type \u7684\u6642\u5019\u628a\u6240\u6709\u9700\u8981\u7684\u6b04\u4f4d\u88dc\u4e0a\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="tempData.js" showLineNumbers',title:'"tempData.js"',showLineNumbers:!0},'const Animals = [\n  {\n    name: "\u72fc\u86db",\n    footLength: 123,\n  },\n  {\n    name: "\u5947\u7570\u9ce5",\n    footLength: 123,\n    wingLength: 456,\n    wing: false,\n  },\n];\n')),(0,a.kt)("p",null,"\u50cf\u662f\u9019\u6a23"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="typeDefs.js" showLineNumbers',title:'"typeDefs.js"',showLineNumbers:!0},'const { gql } = require("apollo-server");\n\nconst typeDefs = gql`\n  type Animal {\n    name: String\n    footLength: Int\n    wingLength: Int\n    wing: Boolean\n  }\n\n  type Query {\n    animals: [Animal!]!\n  }\n`;\n\nmodule.exports = typeDefs;\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"resolvers.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const { Animals } = require("./tempData");\n\nconst resolvers = {\n  Query: {\n    animals: () => {\n      return Animals;\n    },\n  },\n};\n\nmodule.exports = resolvers;\n')),(0,a.kt)("p",null,"\u4f46\u6703\u767c\u73fe\u57f7\u884c query \u5f8c\uff0c\u7b2c\u4e00\u7b46\u8cc7\u6599\u7684\u5176\u4ed6\u6b04\u4f4d\u6703\u662f null\uff0c\u9019\u4e26\u4e0d\u662f\u6211\u5011\u60f3\u8981\u7684\u7d50\u679c\uff0c\u56e0\u70ba\u5982\u679c\u8a72 type \u6709\u52a0\u4e0a \xa0! \u7684\u8a71\uff0c\u56de\u50b3\u7684\u8cc7\u6599\u542b\u6709 null \u5c31\u6703\u5831\u932f\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/hXxxMWh.png",alt:null})),(0,a.kt)("p",null,"\u9019\u6642\u5019\uff0c\u53ef\u4ee5\u5229\u7528 interface \u4f86\u89e3\u6c7a\u4e0a\u8ff0\u7684\u554f\u984c~"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="typeDefs.js" showLineNumbers',title:'"typeDefs.js"',showLineNumbers:!0},'const { gql } = require("apollo-server");\n\nconst typeDefs = gql`\n  interface Animal {\n    name: String\n    footLength: Int\n  }\n\n  type Spider implements Animal {\n    name: String\n    footLength: Int\n  }\n\n  type Bird implements Animal {\n    name: String\n    footLength: Int\n    wingLength: Int\n    wing: Boolean\n  }\n\n  type Query {\n    animals: [Animal]\n  }\n`;\n\nmodule.exports = typeDefs;\n')),(0,a.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u6211\u5011\u628a\u7bc4\u4f8b\u8cc7\u6599\u7684\u5171\u540c\u9375\u503c\u62bd\u53d6\u51fa\u4f86\uff0c\u7368\u7acb\u6210\u53e6\u5916\u7684 type \uff0c\u9019\u908a\u8981\u6ce8\u610f\uff0c\u53ea\u8981\u8a72 type \u6709 implements interface\uff0c\u4e00\u5b9a\u8981\u628a interface \u5167\u7684 type \u5728\u91cd\u65b0\u5b9a\u7fa9\u4e00\u6b21\u4e14\u578b\u614b\u90fd\u8981\u4e00\u6a23\uff0c\u985e\u4f3c\u62bd\u8c61\u985e\u5225\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="resolvers.js" showLineNumbers',title:'"resolvers.js"',showLineNumbers:!0},'const { Animals } = require("./tempData");\n\nconst resolvers = {\n  Animal: {\n    __resolveType(obj) {\n      //\u6aa2\u67e5obj\u88e1\u9762\u662f\u5426\u6709wingLength\u7684\u9375\u503c(key)\n      if (obj.wingLength) {\n        //\u6709\u7684\u8a71\u5c31\u56de\u50b3Bird\u7684type\n        return "Bird";\n      }\n\n      //\u6c92\u6709\u7684\u8a71\u5c31\u56de\u50b3 Spider type\n      return "Spider";\n    },\n  },\n\n  Query: {\n    animals: () => {\n      return Animals;\n    },\n  },\n};\n\nmodule.exports = resolvers;\n')),(0,a.kt)("p",null,"\u90a3 query \u7684\u90e8\u5206\u8981\u600e\u9ebc\u4e0b\u5462?"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},"query Query {\n  animals {\n    ... on Spider {\n      name\n      footLength\n    }\n    ... on Bird {\n      name\n      wingLength\n      footLength\n      wing\n    }\n  }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/XRtadKz.png",alt:null})),(0,a.kt)("h2",{id:"union"},"Union"),(0,a.kt)("p",null,"Union \u8207 Interface \u883b\u76f8\u4f3c\u7684\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0b\u7684\u5b9a\u7fa9\u65b9\u5f0f\u8207 Interface \u7684\u5dee\u7570\uff0c \u6700\u5927\u7684\u5dee\u7570\u5c31\u5728\u65bc\u5982\u679c type \u6709 implements interface\uff0c\u5247\u8a72 type \u5fc5\u9808\u5c07 interface \u7684\u5167\u7684 type \u5168\u90e8\u5b9a\u7fa9\uff0c\u5426\u5247\u6703\u5831\u932f\uff0c\u800c Union \u5247\u4e0d\u7528\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="tempData.js" showLineNumbers',title:'"tempData.js"',showLineNumbers:!0},'const Animals = [\n  {\n    name: "\u72fc\u86db",\n    footLength: 123,\n  },\n  {\n    name: "\u5947\u7570\u9ce5",\n    wingLength: 456,\n  },\n];\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="typeDefs.js" showLineNumbers',title:'"typeDefs.js"',showLineNumbers:!0},'const { gql } = require("apollo-server");\n\nconst typeDefs = gql`\n  union Animal = Spider | Bird\n\n  type Spider {\n    name: String\n    footLength: Int\n  }\n\n  type Bird {\n    name: String\n    wingLength: Int\n  }\n\n  type Query {\n    animals: [Animal]\n  }\n`;\n\nmodule.exports = typeDefs;\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="resolvers.js" showLineNumbers',title:'"resolvers.js"',showLineNumbers:!0},'const { Animals } = require("./tempData");\n\nconst resolvers = {\n  Animal: {\n    __resolveType(obj) {\n      if (obj.footLength) {\n        return "Spider";\n      }\n\n      if (obj.wingLength) {\n        return "Bird";\n      }\n    },\n  },\n\n  Query: {\n    animals: (parent, args, context) => {\n      return Animals;\n    },\n  },\n};\n\nmodule.exports = resolvers;\n')),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/isxCIF5.png",alt:null})))}m.isMDXComponent=!0}}]);