"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2806],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),c=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,p=u(e,["components","mdxType","originalType","parentName"]),m=c(n),d=o,g=m["".concat(i,".").concat(d)]||m[d]||l[d]||s;return n?r.createElement(g,a(a({ref:t},p),{},{components:n})):r.createElement(g,a({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=m;var u={};for(var i in t)hasOwnProperty.call(t,i)&&(u[i]=t[i]);u.originalType=e,u.mdxType="string"==typeof e?e:o,a[1]=u;for(var c=2;c<s;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9942:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>l,frontMatter:()=>s,metadata:()=>u,toc:()=>c});var r=n(7462),o=(n(7294),n(3905));const s={title:"React Protected Routes",keywords:["react","react\u6559\u5b78","react protected routes"],description:1,author:"WeiYun0912","og:title":"React Protected Routes","og:description":"1\u3002"},a=void 0,u={unversionedId:"React/React-Protected-Routes",id:"React/React-Protected-Routes",title:"React Protected Routes",description:"1",source:"@site/docs/React/React-Protected-Routes.md",sourceDirName:"React",slug:"/React/React-Protected-Routes",permalink:"/Wei-Docusaurus/docs/React/React-Protected-Routes",draft:!1,tags:[],version:"current",frontMatter:{title:"React Protected Routes",keywords:["react","react\u6559\u5b78","react protected routes"],description:"1",author:"WeiYun0912","og:title":"React Protected Routes","og:description":"1\u3002"},sidebar:"tutorialSidebar",previous:{title:"React\u5e38\u7528\u7684JavaScript\u8a9e\u6cd5 - \u53ef\u9078\u93c8",permalink:"/Wei-Docusaurus/docs/React/React-Optional-Chaining"},next:{title:"React Query \u6559\u5b78",permalink:"/Wei-Docusaurus/docs/React/React-Query"}},i={},c=[{value:"\u5b89\u88dd",id:"\u5b89\u88dd",level:2},{value:"\u8cc7\u6599\u593e\u8207\u6a94\u6848\u7d50\u69cb",id:"\u8cc7\u6599\u593e\u8207\u6a94\u6848\u7d50\u69cb",level:2},{value:"\u521d\u59cb\u5316",id:"\u521d\u59cb\u5316",level:2},{value:"Protected Routes",id:"protected-routes",level:2},{value:"Protected Routes \u6b0a\u9650\u8a2d\u5b9a",id:"protected-routes-\u6b0a\u9650\u8a2d\u5b9a",level:2}],p={toc:c};function l(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u5b89\u88dd"},"\u5b89\u88dd"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npx create-react-app \u4f60\u7684\u5c08\u6848\u540d\u7a31\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm install react-router-dom\n")),(0,o.kt)("h2",{id:"\u8cc7\u6599\u593e\u8207\u6a94\u6848\u7d50\u69cb"},"\u8cc7\u6599\u593e\u8207\u6a94\u6848\u7d50\u69cb"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/WeiYun0912/React-Protected-Routes"},"\u7a0b\u5f0f\u78bc\u9023\u7d50")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"src\n|   App.js\n|   index.js\n|   ...\n|\n\u2514\u2500\u2500\u2500 components\n\u2502   \u2502   Navbar.js\n\u2502\n\u2514\u2500\u2500\u2500 pages\n\u2502   \u2502   Home.js\n\u2502   \u2502   Login.js\n\u2502   \u2502   Accounts.js\n\u2502   \u2502   Dashboard.js\n\u2502\n\u2514\u2500\u2500\u2500 utils\n\u2502   \u2502   ProtectedRoutes.js\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/8TaIBmQ.png",alt:"Image"})),(0,o.kt)("h2",{id:"\u521d\u59cb\u5316"},"\u521d\u59cb\u5316"),(0,o.kt)("p",null,"\u4eca\u5929\u8981\u4f86\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528 React Router \u4f86\u5be6\u4f5c Protected Routes\uff0c\u610f\u601d\u662f\u6211\u5011\u53ef\u4ee5\u5c07 Route \u8a2d\u5b9a\u6b0a\u9650\uff0c\u7576\u4f7f\u7528\u8005\u767b\u5165\u6642\u6216\u5177\u5099\u67d0\u4e9b\u6b0a\u9650\u624d\u80fd\u5920\u8a2a\u554f\u8a72 Route (\u9801\u9762)\u3002"),(0,o.kt)("p",null,"\u57fa\u672c\u7684 Router \u5b9a\u7fa9\u5c31\u5148\u4e0d\u4ecb\u7d39\uff0c\u56e0\u70ba\u4e3b\u8981\u662f focus \u5728 Protected Routes \u7684\u90e8\u5206\u3002"),(0,o.kt)("p",null,"\u9996\u5148\u5728 App.js \u5f15\u5165\u4e86 4 \u500b\u9801\u9762\u548c\u4e00\u500b component\u3002"),(0,o.kt)("p",null,"\u9801\u9762\u7684\u90e8\u5206\u4e00\u5171\u6709 4 \u500b\u6a94\u6848\uff0c\u5206\u5225\u662f Home\u3001Login\u3001Dashboard\u3001Accounts\u3002"),(0,o.kt)("p",null,"component \u5247\u662f\u50c5\u6709 1 \u500b\u6a94\u6848\uff0cNavbar\u3002"),(0,o.kt)("p",null,"\u53e6\u5916\uff0c\u9084\u6709\u4e00\u500b user \u7269\u4ef6\uff0c\u5224\u65b7\u4f7f\u7528\u8005\u662f\u5426\u5df2\u7d93\u767b\u5165\uff0c\u9810\u8a2d\u70ba\u5c1a\u672a\u767b\u5165 false\uff0ctrue \u7684\u5316\u70ba\u767b\u5165\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='App.js' showLineNumbers",title:"'App.js'",showLineNumbers:!0},'import { BrowserRouter as Router, Route, Routes } from "react-router-dom";\nimport "./App.css";\nimport Navbar from "./components/Navbar";\nimport Login from "./pages/Login";\nimport Home from "./pages/Home";\nimport Accounts from "./pages/Accounts";\nimport Dashboard from "./pages/Dashboard";\n\nfunction App() {\n  const user = { login: false };\n  return (\n    <div className="App">\n      <Router>\n        <Navbar />\n        <Routes>\n          <Route path="/" element={<Home />} />\n          <Route path="/login" element={<Login />} />\n          <Route path="/dashboard" element={<Dashboard />} />\n          <Route path="/account" element={<Accounts />} />\n        </Routes>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='Navbar.js' showLineNumbers",title:"'Navbar.js'",showLineNumbers:!0},'import React from "react";\nimport { Link } from "react-router-dom";\nconst Navbar = () => {\n  return (\n    <div>\n      <Link to="/">Home</Link> | <Link to="/login">Login</Link> |\n      <Link to="/account"> Account</Link> |{" "}\n      <Link to="/dashboard">Dashboard</Link>\n    </div>\n  );\n};\n\nexport default Navbar;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='Home.js' showLineNumbers",title:"'Home.js'",showLineNumbers:!0},'import React from "react";\n\nconst Home = () => {\n  return <div>\ud83e\udd74 Home Page</div>;\n};\n\nexport default Home;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='Login.js' showLineNumbers",title:"'Login.js'",showLineNumbers:!0},'import React from "react";\n\nconst Login = () => {\n  return <div>\ud83d\ude07 Login Page</div>;\n};\n\nexport default Login;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='Dashboard.js' showLineNumbers",title:"'Dashboard.js'",showLineNumbers:!0},'import React from "react";\n\nconst Dashboard = () => {\n  return <div>\ud83e\udd70 Dashboard Page (Need Protected)</div>;\n};\n\nexport default Dashboard;\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='Accounts.js' showLineNumbers",title:"'Accounts.js'",showLineNumbers:!0},'import React from "react";\n\nconst Accounts = () => {\n  return <div>\ud83d\ude00 Accounts Page (Need Protected)</div>;\n};\n\nexport default Accounts;\n')),(0,o.kt)("p",null,"\u800c\u6211\u5011\u5e0c\u671b\u5728 Dashboard \u548c Account \u9801\u9762\u662f\u7576\u4f7f\u7528\u8005\u767b\u5165\u5f8c\u624d\u80fd\u5920\u8a2a\u554f\u7684\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u8981\u662f\u4f7f\u7528\u8005\u5728\u6c92\u767b\u5165\u7684\u60c5\u6cc1\u4e0b\u8a2a\u554f\u8a72\u9801\u9762\uff0c\u5c07\u6703\u88ab\u5c0e\u5411 Home \u9801\u9762\u3002")),(0,o.kt)("h2",{id:"protected-routes"},"Protected Routes"),(0,o.kt)("p",null,"\u77e5\u9053\u4ee5\u4e0a\u9700\u6c42\u5f8c\uff0c\u53ef\u4ee5\u958b\u59cb\u5efa\u7acb\u6211\u5011\u7684 Protected Routes\uff0c\u5728\u8a72\u6a94\u6848\u4e2d\u5f15\u5165 Navigate \u548c Outlet\uff0c\u4e26\u5224\u65b7\u4f7f\u7528\u8005\u662f\u5426\u70ba\u767b\u5165\u72c0\u614b\uff0c\u662f\u7684\u8a71\u56de\u50b3 Outlet\uff0c\u4e0d\u662f\u7684\u8a71\u5c31\u4f7f\u7528 Navigate \u5c07\u4f7f\u7528\u8005\u5c0e\u5411\u4e3b\u9801\u9762\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='ProtectedRoutes.js' showLineNumbers",title:"'ProtectedRoutes.js'",showLineNumbers:!0},'import React from "react";\nimport { Navigate, Outlet } from "react-router-dom";\n\nconst ProtectedRoutes = ({ user }) => {\n  return user.login ? <Outlet /> : <Navigate to="/" />;\n};\n\nexport default ProtectedRoutes;\n')),(0,o.kt)("admonition",{title:"\u5099\u8a3b",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Outlet \u6703\u5728\u5f85\u6703\u5c07 ProtectedRoutes.js \u5f15\u5165 App.js \u6642\u8aaa\u660e\u5b83\u7684\u7528\u8655\u3002")),(0,o.kt)("p",null,"\u5b9a\u7fa9\u5b8c Protected Routes \u5f8c\uff0c\u5c31\u5c07\u5b83\u5f15\u5165\u5230 App.js\uff0c\u53ef\u4ee5\u770b\u5230\u5728 Route \u7684\u5730\u65b9\uff0cProtectedRoutes \u5305\u4f4f\u4e86 Dashboard \u548c Accounts\uff0c\u9019\u4e5f\u7a31\u4f5c",(0,o.kt)("strong",{parentName:"p"},"\u5de2\u72c0\u8def\u7531(Nested Routes)"),"\uff0c\u4e14\u6211\u5011\u4e5f\u5c07 user \u7269\u4ef6\u50b3\u5165 ProtectedRoutes \u4e2d\uff0c\u9019\u6a23\u624d\u80fd\u5224\u65b7\u4f7f\u7528\u8005\u76ee\u524d\u767b\u5165\u7684\u72c0\u614b\u70ba\u4f55\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='App.js' showLineNumbers {11,20-23}",title:"'App.js'",showLineNumbers:!0,"{11,20-23}":!0},'import { BrowserRouter as Router, Route, Routes } from "react-router-dom";\nimport "./App.css";\nimport Navbar from "./components/Navbar";\nimport Login from "./pages/Login";\nimport Home from "./pages/Home";\nimport Accounts from "./pages/Accounts";\nimport Dashboard from "./pages/Dashboard";\nimport ProtectedRoutes from "./utils/ProtectedRoutes";\n\nfunction App() {\n  const user = { login: false };\n  return (\n    <div className="App">\n      <Router>\n        <Navbar />\n        <Routes>\n          <Route path="/" element={<Home />} />\n          <Route path="/login" element={<Login />} />\n\n          <Route element={<ProtectedRoutes user={user} />}>\n            <Route path="/dashboard" element={<Dashboard />} />\n            <Route path="/account" element={<Accounts />} />\n          </Route>\n        </Routes>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n')),(0,o.kt)("p",null,"\u73fe\u5728\u5230\u7db2\u9801\u9ede\u64ca Account \u548c Dashboard\uff0c\u6703\u767c\u73fe\u88ab\u91cd\u65b0\u5c0e\u5411 Home \u9801\u9762\u4e86\uff0c\u9019\u662f\u56e0\u70ba\u76ee\u524d user \u7269\u4ef6\u7684 login \u70ba false\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/KsnIQL5.gif",alt:"Image"})),(0,o.kt)("p",null,"\u800c\u73fe\u5728\u53ea\u8981\u5c07 login \u66f4\u6539\u70ba true \u5f8c\uff0c\u518d\u6b21\u9ede\u64ca Account \u548c Dashboard\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/b735QNs.gif",alt:"Image"})),(0,o.kt)("p",null,"\u9084\u8a18\u5f97\u525b\u525b\u9084\u6c92\u8aaa\u660e\u7684 Outlet \u55ce?"),(0,o.kt)("p",null,"Outlet \u901a\u5e38\u5728\u7236\u8def\u7531(parent route)\u4e2d\u4f7f\u7528\uff0c\u76ee\u7684\u662f\u8b93\u5b50\u8def\u7531(child route)\u80fd\u5920\u88ab\u5339\u914d\u4e26\u5c07\u8a72\u5b50\u8def\u7531\u7684 element \u6e32\u67d3\u5230\u756b\u9762\u4e0a\u3002"),(0,o.kt)("p",null,"\u800c\u95dc\u65bc Outlet\uff0c\u5b98\u65b9\u7684\u5b9a\u7fa9\u70ba\uff1a"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"An ",(0,o.kt)("inlineCode",{parentName:"p"},"<Outlet>")," should be used in parent route elements to render their child route elements. This allows nested UI to show up when child routes are rendered. If the parent route matched exactly, it will render a child index route or nothing if there is no index route.")),(0,o.kt)("h2",{id:"protected-routes-\u6b0a\u9650\u8a2d\u5b9a"},"Protected Routes \u6b0a\u9650\u8a2d\u5b9a"),(0,o.kt)("p",null,"\u4f46\u4e00\u822c\u7db2\u9801\u4e26\u4e0d\u6703\u53ea\u6709\u5224\u65b7\u767b\u5165\u8207\u767b\u51fa\u5169\u7a2e\u72c0\u614b\uff0c\u9084\u9700\u8981\u8003\u616e\u5230\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u70ba\u4e00\u822c\u6703\u54e1\u9084\u662f\u7ba1\u7406\u54e1\uff0c\u56e0\u61c9\u4e0d\u540c\u7684\u6b0a\u9650\uff0c\u53ef\u8a2a\u554f\u7684\u9801\u9762\u4e5f\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u5011\u5728 user \u7269\u4ef6\u4e2d\u50b3\u5165 permission \u5c6c\u6027\uff0c\u578b\u614b\u70ba\u9663\u5217\uff0c\u56e0\u70ba\u5f85\u6703\u6703\u7528\u5230\u9663\u5217\u7684\u65b9\u6cd5\u4f86\u5224\u65b7\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u3002"),(0,o.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u5011\u4e5f\u5ba3\u544a\u4e86\u4e00\u500b\u7269\u4ef6 Permission\uff0c\u7528\u4f86\u8b93 Route \u77e5\u9053\u54ea\u4e9b\u6b0a\u9650\u7684\u4f7f\u7528\u8005\u80fd\u5920\u8a2a\u554f\u8a72 Route\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='App.js' showLineNumbers {10-13,16,24-42}",title:"'App.js'",showLineNumbers:!0,"{10-13,16,24-42}":!0},'import { BrowserRouter as Router, Route, Routes } from "react-router-dom";\nimport "./App.css";\nimport Navbar from "./components/Navbar";\nimport Login from "./pages/Login";\nimport Home from "./pages/Home";\nimport Accounts from "./pages/Accounts";\nimport Dashboard from "./pages/Dashboard";\nimport ProtectedRoutes from "./utils/ProtectedRoutes";\n\nconst Permission = {\n  User: "User",\n  Admin: "Admin",\n};\n\nfunction App() {\n  //\u4f7f\u7528\u8005\u6b0a\u9650\u70ba\u4e00\u822c\u4f7f\u7528\u8005 User\n  const user = { login: true, permission: ["User"] };\n  return (\n    <div className="App">\n      <Router>\n        <Navbar />\n        <Routes>\n          <Route path="/" element={<Home />} />\n          <Route path="/login" element={<Login />} />\n          /*\u6b0a\u9650\u70ba Admin \u7684\u80fd\u5920\u8a2a\u554f Accounts \u9801\u9762*/\n          <Route\n            element={\n              <ProtectedRoutes user={user} Permission={[Permission.Admin]} />\n            }\n          >\n            <Route path="/account" element={<Accounts />} />\n          </Route>\n          /*\u6b0a\u9650\u70ba User \u548c Admin \u7684\u80fd\u5920\u8a2a\u554f Dashboard \u9801\u9762*/\n          <Route\n            element={\n              <ProtectedRoutes\n                user={user}\n                Permission={[Permission.Admin, Permission.User]}\n              />\n            }\n          >\n            <Route path="/dashboard" element={<Dashboard />} />\n          </Route>\n        </Routes>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n')),(0,o.kt)("p",null,"\u800c\u5728 ProtectedRoutes \u5167\uff0c\u53ea\u8981\u4f7f\u7528 find \u5224\u65b7\u4f7f\u7528\u8005\u7684\u6b0a\u9650 (permission) \u5167\u662f\u5426\u6709\u5305\u542b (includes) Route \u6240\u9700\u8981\u7684\u6b0a\u9650 (Permission) \u5373\u53ef\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"title='ProtectedRoutes.js' showLineNumbers",title:"'ProtectedRoutes.js'",showLineNumbers:!0},'import React from "react";\nimport { Outlet, Navigate } from "react-router-dom";\n\nconst ProtectedRoutes = ({ user, Permission }) => {\n  //user\u7269\u4ef6\u5167\u7684permission\u70ba permission : ["User"]\n  //Account \u9801\u9762  permission \u50c5\u6709 Admin \u80fd\u8a2a\u554f\n  //Dashboard \u9801\u9762  permission User \u548c Admin \u90fd\u80fd\u8a2a\u554f\n  return user.login &&\n    user.permission.find((per) => Permission.includes(per)) ? (\n    <Outlet />\n  ) : (\n    <Navigate to={"/"} />\n  );\n};\n\nexport default ProtectedRoutes;\n')),(0,o.kt)("p",null,"\u7576\u4f7f\u7528\u8005\u70ba User \u6b0a\u9650\u6642"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/x0R3lhs.gif",alt:"Image"})),(0,o.kt)("p",null,"\u7576\u4f7f\u7528\u8005\u70ba Admin \u6b0a\u9650\u6642"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/cPRUDSA.gif",alt:"Image"})))}l.isMDXComponent=!0}}]);