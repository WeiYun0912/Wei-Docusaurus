"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3667],{3905:(t,e,r)=>{r.d(e,{Zo:()=>u,kt:()=>k});var n=r(7294);function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}var i=n.createContext({}),p=function(t){var e=n.useContext(i),r=e;return t&&(r="function"==typeof t?t(e):l(l({},e),t)),r},u=function(t){var e=p(t.components);return n.createElement(i.Provider,{value:e},t.children)},s={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},m=n.forwardRef((function(t,e){var r=t.components,a=t.mdxType,o=t.originalType,i=t.parentName,u=c(t,["components","mdxType","originalType","parentName"]),m=p(r),k=a,y=m["".concat(i,".").concat(k)]||m[k]||s[k]||o;return r?n.createElement(y,l(l({ref:e},u),{},{components:r})):n.createElement(y,l({ref:e},u))}));function k(t,e){var r=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var o=r.length,l=new Array(o);l[0]=m;var c={};for(var i in e)hasOwnProperty.call(e,i)&&(c[i]=e[i]);c.originalType=t,c.mdxType="string"==typeof t?t:a,l[1]=c;for(var p=2;p<o;p++)l[p]=r[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},9915:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>s,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={title:"Reentrancy \u91cd\u5165\u653b\u64ca"},l=void 0,c={unversionedId:"Blockchain/Solidity/Hack/reentrancy",id:"Blockchain/Solidity/Hack/reentrancy",title:"Reentrancy \u91cd\u5165\u653b\u64ca",description:"\u8aaa\u660e",source:"@site/docs/Blockchain/Solidity/Hack/reentrancy.md",sourceDirName:"Blockchain/Solidity/Hack",slug:"/Blockchain/Solidity/Hack/reentrancy",permalink:"/Wei-Docusaurus/docs/Blockchain/Solidity/Hack/reentrancy",draft:!1,tags:[],version:"current",frontMatter:{title:"Reentrancy \u91cd\u5165\u653b\u64ca"},sidebar:"tutorialSidebar",previous:{title:"\u5229\u7528 tx.origin \u505a\u91e3\u9b5a\u5f0f\u653b\u64ca",permalink:"/Wei-Docusaurus/docs/Blockchain/Solidity/Hack/phishing"},next:{title:"Selfdestruct",permalink:"/Wei-Docusaurus/docs/Blockchain/Solidity/Hack/selfdestruct"}},i={},p=[{value:"\u8aaa\u660e",id:"\u8aaa\u660e",level:2},{value:"nonReentrant",id:"nonreentrant",level:2},{value:"Updated balance before sent ether",id:"updated-balance-before-sent-ether",level:2},{value:"Slither",id:"slither",level:2}],u={toc:p};function s(t){let{components:e,...r}=t;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u8aaa\u660e"},"\u8aaa\u660e"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/WeiYun0912/SmartContracts/tree/main/Hack/Reentrancy"},"Github \u9023\u7d50")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=q7ZN6Lurs1U"},"\u5f71\u7247\u9023\u7d50")),(0,a.kt)("p",null,"\u5047\u4f7f\u6709\u4e00\u667a\u80fd\u5408\u7d04\u540d\u70ba CryptoCurrencyStore\uff0c\u8a72\u5408\u7d04\u5be6\u4f5c\u4e86\u5b58\u6b3e\u8207\u53d6\u6b3e\u529f\u80fd\uff0c\u800c\u4f7f\u7528\u8005 A \u548c\u4f7f\u7528\u8005 B \u5b58\u5165\u4e86\u5169\u679a\u4ee5\u592a\u5e63\uff0c\u55ae\u4f4d\u70ba wei\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/wxUahGk.png",alt:"Image"})),(0,a.kt)("p",null,"\u8a72\u667a\u80fd\u5408\u7d04\u7684\u5b58\u6b3e\u8207\u53d6\u6b3e function \u5982\u4e0b\u5716\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/6oCl0cM.png",alt:"Image"})),(0,a.kt)("p",null,"\u9019\u6642\u653b\u64ca\u8005\u767c\u73fe\u4e86 CryptoCurrencyStore \u7684\u5408\u7d04\u6f0f\u6d1e\uff0c\u4e26\u81ea\u884c\u90e8\u7f72\u4e86\u4e00\u500b\u667a\u80fd\u5408\u7d04\uff0c\u540d\u70ba AttackCryptoCurrencyStore\uff0c\u8981\u4f86\u5c07 CryptoCurrencyStore \u5408\u7d04\u5167\u7684\u4ee5\u592a\u5e63\u5168\u6578\u8f49\u79fb\u5230\u653b\u64ca\u8005\u7684\u5408\u7d04\u3002"),(0,a.kt)("p",null,"\u653b\u64ca\u8005\u5728\u90e8\u7f72 AttackCryptoCurrencyStore \u6642\u6703\u5c07 CryptoCurrencyStore \u7684\u5408\u7d04\u5730\u5740\u50b3\u5165\u5efa\u69cb\u5f0f\uff0c\u4ee5\u6b64\u65b9\u4fbf\u547c\u53eb CryptoCurrencyStore \u5167\u7684 function\u3002"),(0,a.kt)("p",null,"\u4e00\u65e6\u57f7\u884c attack function\uff0c\u5c31\u80fd\u5c07 CryptoCurrencyStore \u5167\u7684\u4ee5\u592a\u5e63\u5168\u6578\u6e05\u96f6\u4e26\u8f49\u79fb\u5230 AttackCryptoCurrencyStore\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/7zGQ8qW.png",alt:"Image"})),(0,a.kt)("p",null,"\u5176\u653b\u64ca\u6d41\u7a0b\u70ba\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u653b\u64ca\u8005\u547c\u53eb attack function"),(0,a.kt)("li",{parentName:"ol"},"\u57f7\u884c CryptoCurrencyStore \u7684 deposit function \u9032\u884c\u5b58\u6b3e\uff0c\u518d\u547c\u53eb withdraw function \u9032\u884c\u63d0\u6b3e\u3002"),(0,a.kt)("li",{parentName:"ol"},'\u7576 withdraw function \u57f7\u884c\u5230 (bool sent, ) = msg.sender.call{value: userBalance}("") \u9019\u6bb5\u6642\uff0c\u5c07\u6703\u89f8\u767c AttackCryptoCurrencyStore \u7684 fallback\u3002'),(0,a.kt)("li",{parentName:"ol"},"fallback function \u5167\u53c8\u6703\u518d\u547c\u53eb withdraw function\uff0c\u6240\u4ee5\u53c8\u6703\u5f9e withdraw function \u7684\u7b2c\u4e00\u6bb5\u958b\u59cb\u57f7\u884c\u3002"),(0,a.kt)("li",{parentName:"ol"},'\u56e0\u904e\u7a0b\u4e2d\u4e0d\u6703\u89f8\u767c\u5230 require(sent, "Failed to send Ether")\uff0c\u5c0e\u81f4\u653b\u64ca\u8005\u7684\u4ee5\u592a\u5e63\u4e26\u4e0d\u6703\u88ab balances',"[msg.sender]"," = 0 \u521d\u59cb\u5316\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u900f\u904e\u4e0d\u65b7\u5730\u60e1\u610f\u5faa\u74b0\uff0c\u6700\u7d42 CryptoCurrencyStore \u5167\u7684\u4ee5\u592a\u5e63\u5c07\u5168\u6578\u8f49\u79fb\u81f3 AttackCryptoCurrencyStore\u3002")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/qHom4et.png",alt:null})),(0,a.kt)("h2",{id:"nonreentrant"},"nonReentrant"),(0,a.kt)("p",null,"\u8981\u6709\u6548\u62b5\u64cb\u91cd\u5165\u653b\u64ca\uff0c\u53ef\u4ee5\u5229\u7528 modifier \u8a2d\u5b9a\u8b8a\u6578 state \u4f86\u8b93\u653b\u64ca\u8005\u7684 fallback \u7121\u6cd5\u91cd\u8907\u57f7\u884c\u3002"),(0,a.kt)("p",null,'\u7576\u653b\u64ca\u8005\u57f7\u884c withdraw function \u6642\uff0c\u56e0\u70ba\u6709 nonReentrant modifier \u7684\u95dc\u4fc2\uff0c\u7b2c\u4e00\u6b21\u57f7\u884c lockedState \u6703\u88ab\u66f4\u6539\u70ba true\uff0c\u800c\u7576\u89f8\u767c\u5230\u653b\u64ca\u8005\u7684 fallback \u6642\uff0c\u6703\u518d\u4e00\u6b21\u7684\u57f7\u884c withdraw\uff0c\u4f46\u56e0\u70ba\u9019\u6642 lockedState \u70ba true\uff0c\u4f7f\u653b\u64ca\u8005\u4e26\u7121\u6cd5\u901a\u904e require(!lockedState, "Block re-entrancy")\uff0c\u6700\u7d42\u8a72\u7b46\u4ea4\u6613\u5c07\u88ab revert\u3002'),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/AOyo9hl.png",alt:"Image"})),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/qT0z93p.png",alt:"Image"})),(0,a.kt)("h2",{id:"updated-balance-before-sent-ether"},"Updated balance before sent ether"),(0,a.kt)("p",null,"\u53e6\u4e00\u7a2e\u9632\u7bc4\u65b9\u5f0f\u662f\u5148\u6263\u9664\u4f7f\u7528\u8005\u7684\u5b58\u6b3e\u9918\u984d\uff0c\u518d\u5c07\u9322\u8f49\u81f3\u4f7f\u7528\u8005\u7684\u5e33\u865f\u5730\u5740\u5167\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/T0bE4kn.png",alt:"Image"})),(0,a.kt)("h2",{id:"slither"},"Slither"),(0,a.kt)("p",null,"\u4f7f\u7528 Slither \u6e2c\u8a66\u539f\u672c\u7121\u9632\u8b77\u6a5f\u5236\u7684\u7a0b\u5f0f\u78bc\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/acU3o47.png",alt:"Image"})),(0,a.kt)("p",null,"\u8a2d\u5b9a\u9632\u8b77\u6a5f\u5236\u5f8c\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/USDRZA6.png",alt:"Image"})))}s.isMDXComponent=!0}}]);